{% extends "base.html" %}
{% block title %} {{ post.title }} {% endblock %}
{% block content %}
{% load custom_tags %}
{% load templatetag_handlebars %}

<div class="blogitem">

	<h2> {{ post.title }} </h2>

		<p class="blog_meta">
			Posted by Ms Coco on {{ post.created|date:"l d F Y" }}
			<span class="meta tags">
				<i class="icon-tag"></i>
				{% for tag in post.tags.all %}
					<a href="/tag/{{tag}}">{{tag}}</a>{% if not forloop.last %}, {% endif %}
				{% endfor %}
			</span>
			<span class="meta comments">
				<i class="icon-comments"></i> 
				{% if comments %}
					{{comments|length}} comment{{ comments|pluralize }}
				{% else %}
					No comments
				{% endif %}
			</span>				
		</p>

	<div class="post_body">
		{{ post.body|safe|linebreaks }}
	</div>

</div>
	
	<!-- commments -->
	<ul id="comments" class = "comments-list">
		{% if comments %}
				{% for comment in comments %}
					<li class="comment">
						<div>
							<span class="name">
								{{ comment.author }}
							</span>
							<span class="">
								{{ comment.posted_on|prettify_date }}
							</span>
							<p class="comment-body">
								{{ comment.body }}
							</p>
						</div>
					</li>
				{% endfor %}
		{% endif %}
	</ul>

	{% tplhandlebars "comment-template" %}
		<li>
			<div class="name">
				{{ posted_on }} | {{ author }}
			</div>
			<div class="body">
				{{ body }}
			</div>
		</li>
	{% endtplhandlebars %}

<!-- form -->
	
{% if form %}

	<form action="{% url blog.views.add_comment post.id %}" method="post" class="form-horizontal">
		<fieldset>
		<legend>Add a new comment</legend>
			{% csrf_token %}
	<!-- 		{{form}}
			{{ form.as_p }} -->

			{% for field in form %}
				{% ifequal field.name 'body' %}
					<p>
						{{field}}
					</p>
				{% endifequal %}

				{% ifequal field.name 'author' %}
					<p>
						{{field}}
						<input class="span2" type="text" placeholder="Email">
						<input class="span2" type="text" placeholder="Website">
					</p>
				{% endifequal %}

			{% endfor %}
			<p>
				<button class="btn btn-small" type="submit" disabled>Post Comment</button>
			</p>
		</fieldset>
	</form>

{% endif %}

<script>

	require(["comment"], function(c) {
		var c = new c();
	});

</script>

{% endblock %}